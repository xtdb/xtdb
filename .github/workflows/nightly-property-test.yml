name: XTDB nightly property tests

on:
  workflow_dispatch:
  schedule:
    - cron:  '0 19 * * 1-5'

jobs:
  nightly-property-test:
    if: github.event_name == 'workflow_dispatch' || github.repository == 'xtdb/xtdb'
    uses: ./.github/workflows/property-test.yml
    secrets: inherit
    with:
      iteration_count: "500"
      simulation_iteration_count: "1000"
    permissions:
      contents: read
      checks: write

  notify-success:
    needs: nightly-property-test
    runs-on: ubuntu-latest
    if: success() && github.repository == 'xtdb/xtdb'
    steps:
      - name: Post Slack Notification (On Success)
        uses: ravsamhq/notify-slack-action@be814b201e233b2dc673608aa46e5447c8ab13f2 # v2
        with:
          status: success
          notification_title: "*Nightly Property Test* has {status_message}:"
          message_format: "{emoji} `nightly-property-test` job has {status_message} (500 property / 1000 simulation iterations)"
          notify_when: "success"
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
