[:project
 {:projections [{_column_1 _sq_2}]}
 [:apply
  {:mode :single-join, :columns {bar.1/_valid_time ?_sq__valid_time_3}}
  [:rename
   {:prefix bar.1}
   [:project
    {:projections
     [_valid_from
      _valid_to
      {_valid_time (period _valid_from _valid_to)}]}
    [:scan {:table #xt/table bar, :columns [_valid_from _valid_to]}]]]
  [:project
   {:projections
    [{_sq_2
      (and
       (<
        (lower foo.3/_valid_time)
        (coalesce (upper ?_sq__valid_time_3) xtdb/end-of-time))
       (>
        (coalesce (upper foo.3/_valid_time) xtdb/end-of-time)
        (lower ?_sq__valid_time_3)))}]}
   [:rename
    {:prefix foo.3}
    [:project
     {:projections
      [_valid_from
       _valid_to
       {_valid_time (period _valid_from _valid_to)}]}
     [:scan
      {:table #xt/table foo, :columns [_valid_from _valid_to]}]]]]]]
