[:project
 {:projections
  [_iid
   {_valid_from
    (greatest
     _valid_from
     (cast
      (coalesce (current-timestamp) xtdb/start-of-time)
      #xt/type :instant))}
   {_valid_to
    (least
     (coalesce _valid_to xtdb/end-of-time)
     (coalesce
      (cast xtdb/end-of-time #xt/type :instant)
      xtdb/end-of-time))}
   col1]}
 [:project
  {:projections
   [{_iid t1.1/_iid}
    {_valid_from t1.1/_valid_from}
    {_valid_to t1.1/_valid_to}
    {col1 30}]}
  [:rename
   {:prefix t1.1}
   [:scan
    {:table #xt/table t1,
     :columns
     [{col1 (or (not (boolean (=== 30 col1))))}
      _valid_to
      _valid_from
      _iid],
     :for-valid-time [:in (current-timestamp) xtdb/end-of-time]}]]]]
