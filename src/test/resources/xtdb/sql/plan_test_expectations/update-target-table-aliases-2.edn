[:project
 {:projections [_iid
  {_valid_from
   (greatest
    _valid_from
    (cast
     (coalesce (current-timestamp) xtdb/start-of-time)
     [:timestamp-tz :micro "UTC"]))}
  {_valid_to
   (least
    (coalesce _valid_to xtdb/end-of-time)
    (coalesce
     (cast xtdb/end-of-time [:timestamp-tz :micro "UTC"])
     xtdb/end-of-time))}
  col1]}
 [:project
  {:projections [{_iid t1.1/_iid}
   {_valid_from t1.1/_valid_from}
   {_valid_to t1.1/_valid_to}
   {col1 30}]}
  [:rename {:prefix t1.1} [:scan
    {:table #xt/table t1,
     :for-valid-time [:in (current-timestamp) xtdb/end-of-time], :columns [{col1 (or (not (boolean (=== 30 col1))))}
     _valid_to
     _valid_from
     _iid]}]]]]
